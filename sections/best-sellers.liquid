{% comment %}
  Best sellers section
{% endcomment %}

<section id="best-sellers-{{ section.id }}" class="best-sellers" data-section-id="{{ section.id }}" data-section-type="best-sellers">
  <div class="best-sellers__container">
    {% if section.settings.section_label != blank %}
      <p class="best-sellers__section-label">{{ section.settings.section_label }}</p>
    {% endif %}

    {% if section.settings.title != blank %}
      <h2 class="best-sellers__title">{{ section.settings.title }}</h2>
    {% endif %}

    {% if section.blocks.size > 0 %}
      <div class="best-sellers__grid">
        <div class="best-sellers__collections" role="tablist" aria-orientation="vertical">
          <ul class="best-sellers__collections-list">
            {% for block in section.blocks %}
              {% assign collection = collections[block.settings.collection] %}
              {% if collection %}
                {% assign is_active = forloop.first %}
                <li class="best-sellers__collections-item" {{ block.shopify_attributes }}>
                  <button
                    type="button"
                    class="best-sellers__collections-button{% if is_active %} is-active{% endif %}"
                    data-best-sellers-tab
                    data-block-id="{{ block.id }}"
                    role="tab"
                    aria-selected="{{ is_active }}"
                  >
                    {{ block.settings.collection_title | default: collection.title }}
                  </button>
                </li>
              {% endif %}
            {% endfor %}
          </ul>
        </div>

        <div class="best-sellers__product" role="tabpanel">
          {% for block in section.blocks %}
            {% assign collection = collections[block.settings.collection] %}
            {% if collection %}
              {% assign override_product = all_products[block.settings.product] %}
              {% if override_product %}
                {% assign product = override_product %}
              {% else %}
                {% assign product = collection.products | first %}
              {% endif %}

              {% if product %}
                {% assign is_active = forloop.first %}
                {% assign featured_image = product.featured_image %}

                <article
                  class="best-sellers__product-card{% if is_active %} is-active{% endif %}"
                  data-best-sellers-card
                  data-block-id="{{ block.id }}"
                  data-product-title="{{ product.title | escape }}"
                  data-product-handle="{{ product.handle }}"
                >
                  <div class="best-sellers__media">
                    <a href="{{ product.url }}" class="best-sellers__image-link">
                      {% if featured_image %}
                        <picture>
                          <source
                            media="(max-width: 749px)"
                            srcset="
                              {{ featured_image | image_url: width: 360 }} 1x,
                              {{ featured_image | image_url: width: 720 }} 2x
                            "
                          >
                          <source
                            media="(min-width: 750px)"
                            srcset="
                              {{ featured_image | image_url: width: 520 }} 1x,
                              {{ featured_image | image_url: width: 1040 }} 2x
                            "
                          >
                          <img
                            class="best-sellers__image"
                            src="{{ featured_image | image_url: width: 520 }}"
                            alt="{{ featured_image.alt | escape }}"
                            loading="lazy"
                            width="{{ featured_image.width }}"
                            height="{{ featured_image.height }}"
                          >
                        </picture>
                      {% else %}
                        {{ 'product-1' | placeholder_svg_tag: 'best-sellers__image-placeholder' }}
                      {% endif %}
                    </a>

                    {% assign tag_count = 0 %}
                    {% if product.tags.size > 0 %}
                      <ul class="best-sellers__tags">
                        {% for tag in product.tags %}
                          {% if tag_count == 3 %}
                            {% break %}
                          {% endif %}
                          {% assign tag_count = tag_count | plus: 1 %}
                          {% assign tag_down = tag | downcase %}
                          <li class="best-sellers__tag{% if tag_down == 'sale' %} best-sellers__tag--sale{% endif %}">
                            {{ tag }}
                          </li>
                        {% endfor %}
                      </ul>
                    {% endif %}
                  </div>

                  <div class="best-sellers__content">
                    <a href="{{ product.url }}" class="best-sellers__product-title-link">
                      <h3 class="best-sellers__product-title">{{ product.title }}</h3>
                    </a>

                    {% if product.price %}
                      <div class="best-sellers__price">
                        {% if product.compare_at_price_max > product.price %}
                          <span class="best-sellers__price-current">{{ product.price | money }}</span>
                          <span class="best-sellers__price-compare">{{ product.compare_at_price_max | money }}</span>
                        {% else %}
                          <span class="best-sellers__price-current">{{ product.price | money }}</span>
                        {% endif %}
                      </div>
                    {% endif %}

                    <div class="best-sellers__actions">
                      <button
                        type="button"
                        class="best-sellers__icon-button best-sellers__icon-button--wishlist"
                        aria-label="Add to wishlist"
                      >
                        <span aria-hidden="true">‚ù§</span>
                      </button>

                      {% assign first_variant = product.selected_or_first_available_variant %}
                      <button
                        type="button"
                        class="best-sellers__icon-button best-sellers__icon-button--quick-add"
                        data-variant-id="{{ first_variant.id }}"
                        {% unless product.available %}disabled aria-disabled="true"{% endunless %}
                        aria-label="Quick add to cart"
                      >
                        <span aria-hidden="true">üëÅ</span>
                      </button>
                    </div>
                  </div>
                </article>
              {% endif %}
            {% endif %}
          {% endfor %}
        </div>
      </div>
    {% endif %}
  </div>

  <div class="best-sellers__overlay" data-best-sellers-overlay hidden></div>
  <div class="best-sellers__modal" data-best-sellers-modal hidden role="dialog" aria-modal="true">
    <button type="button" class="best-sellers__modal-close" aria-label="Close">√ó</button>
    <div class="best-sellers__modal-body"></div>
  </div>
</section>

<style>
  .best-sellers {
    position: relative;
    padding: 48px 0;
  }

  .best-sellers__container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 16px;
  }

  .best-sellers__section-label {
    text-transform: uppercase;
    font-size: 12px;
    letter-spacing: 0.12em;
    margin-bottom: 8px;
  }

  .best-sellers__title {
    margin: 0 0 24px;
  }

  .best-sellers__grid {
    display: grid;
    grid-template-columns: minmax(0, 260px) minmax(0, 1fr);
    gap: 32px;
  }

  .best-sellers__collections-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .best-sellers__collections-button {
    width: 100%;
    text-align: left;
    padding: 12px 16px;
    border: none;
    background: transparent;
    cursor: pointer;
    border-radius: 4px;
  }

  .best-sellers__collections-button.is-active {
    background-color: #000;
    color: #fff;
  }

  .best-sellers__product-card {
    display: none;
    gap: 24px;
  }

  .best-sellers__product-card.is-active {
    display: grid;
    grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
    align-items: flex-start;
  }

  .best-sellers__media {
    position: relative;
  }

  .best-sellers__image-link {
    display: block;
  }

  .best-sellers__image {
    display: block;
    width: 100%;
    height: auto;
  }

  .best-sellers__tags {
    position: absolute;
    top: 12px;
    left: 12px;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .best-sellers__tag {
    padding: 4px 8px;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    border-radius: 16px;
    background-color: #000;
    color: #fff;
  }

  .best-sellers__tag--sale {
    background-color: #d93025;
  }

  .best-sellers__product-title {
    margin: 0 0 8px;
  }

  .best-sellers__price {
    margin-bottom: 16px;
    display: flex;
    gap: 8px;
    align-items: baseline;
  }

  .best-sellers__price-compare {
    text-decoration: line-through;
    opacity: 0.6;
    font-size: 0.9em;
  }

  .best-sellers__actions {
    display: flex;
    gap: 8px;
  }

  .best-sellers__icon-button {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 1px solid #ddd;
    background: #fff;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }

  .best-sellers__icon-button[disabled],
  .best-sellers__icon-button[aria-disabled="true"] {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .best-sellers__overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.4);
    z-index: 1000;
  }

  .best-sellers__modal {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1001;
  }

  .best-sellers__modal[hidden],
  .best-sellers__overlay[hidden] {
    display: none !important;
  }

  .best-sellers__modal > div,
  .best-sellers__modal-body {
    max-width: 450px;
  }

  .best-sellers__modal {
    padding: 16px;
  }

  .best-sellers__modal-inner {
    background: #fff;
  }

  .best-sellers__modal {
    pointer-events: none;
  }

  .best-sellers__modal > * {
    pointer-events: auto;
  }

  .best-sellers__modal-body {
    background: #fff;
    border-radius: 8px;
    padding: 24px 24px 20px;
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.16);
  }

  .best-sellers__modal-close {
    position: absolute;
    top: 12px;
    right: 16px;
    border: none;
    background: transparent;
    font-size: 20px;
    cursor: pointer;
  }

  .no-scroll {
    overflow: hidden;
  }

  @media (max-width: 767px) {
    .best-sellers__grid {
      grid-template-columns: minmax(0, 1fr);
    }

    .best-sellers__product-card.is-active {
      grid-template-columns: minmax(0, 1fr);
    }
  }
</style>

{% schema %}
{
  "name": "Best sellers",
  "settings": [
    {
      "type": "text",
      "id": "section_label",
      "label": "Section label"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title"
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },
        {
          "type": "text",
          "id": "collection_title",
          "label": "Collection title (override)"
        },
        {
          "type": "product",
          "id": "product",
          "label": "Product override"
        }
      ]
    }
  ],
  "max_blocks": 3,
  "presets": [
    {
      "name": "Best sellers"
    }
  ]
}
{% endschema %}
